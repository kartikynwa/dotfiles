# Filename:      /etc/zsh/zshrc
# Purpose:       config file for zsh (z shell)
# Author:        moi

# History - Relics of the past.
HISTFILE=~/.config/zsh.d/history
HISTSIZE=1000
SAVEHIST=1000

# title to something sane
precmd () { print -Pn "\e]0;$TITLE\a" }
title() { export TITLE="$*" }

# add to fpath
fpath=("${HOME}/.config/zsh.d" $fpath)

# Variables
BROWSER="firefox"
EDITOR="vim"
SUDO_EDITOR="vim"
PASSWORD_STORE_CLIP_TIME=5
WINEDEBUG=-all

# Colours for ls
LS_COLORS='rs=0:di=01;34:ln=01;36:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:su=37;41:sg=30;43:tw=30;42:ow=01;44:st=37;44:ex=01;32:';
export LS_COLORS

# Keybindings
bindkey -e
typeset -g -A key
bindkey '^?' backward-delete-char
bindkey '^[[5~' up-line-or-history
bindkey '^[[3~' delete-char
bindkey '^[[6~' down-line-or-history
bindkey '^[[A' up-line-or-search
bindkey '^[[D' backward-char
bindkey '^[[B' down-line-or-search
bindkey '^[[C' forward-char
bindkey "^[[H" beginning-of-line
bindkey "^[[F" end-of-line

# Shell options
setopt autocd \
       hist_verify \
       hist_append \
       hist_save_no_dups \
       hist_ignore_space \
       hist_ignore_all_dups

# Aliases (or Alii)
alias :q="exit"
alias n="NNN_USE_EDITOR=1 nnn"
alias ls="ls --color -F --group-directories-first"
alias l=ls
alias ll="ls --color -lh --group-directories-first"
alias rm="rm -vI"
alias cp="cp -vi"
alias mv="mv -vi"
alias mkdir="mkdir -pv"
alias v="nvim"
alias bulkrename="qmv -f do"
alias za="zathura"
alias open="xdg-open"
alias protocol="sudo xbps-install -Suy && sudo poweroff"
alias c=chezmoi

alias xs="xbps-query -Rs"
alias xu="sudo xbps-install -Su"
alias mkdoc="sudo makewhatis /usr/share/man"

alias mpdscribble="/usr/bin/mpdscribble --conf ~/.config/mpdscribble/mpdscribble.conf"
alias shuffle_library="mpc listall synced_music/ | ashuffle -f - & disown"

alias termbin="nc termbin.com 9999"

# Modules
autoload -Uz compinit
compinit
zstyle ':completion:*' menu select
zstyle ':completion:*' use-cache on
zstyle ':completion:*' rehash yes
zstyle ':completion:*' list-colors

autoload -U select-word-style
select-word-style bash

checksha256 () {
  FILE=$(mktemp)
  curl "$1" > "$FILE"
  sha256sum "$FILE"
  rm "$FILE"
}

cheat () {
  if [ -n $1 ]; then
    curl "cheat.sh/${1}"
  else
    echo "USAGE: cheat <command>"
  fi
}
compdef cheat=whereis

# shuffle folder
shuffle () {
  if [ -z $1 ]; then
    mpv --shuffle --audio-display=no --no-resume-playback .
  else
    mpv --shuffle --audio-display=no --no-resume-playback "$@"
  fi
}

# convert lossless to opus
iwantopus () {
  if [ -z "$1" ]
  then
    input_format="flac"
  else
    input_format=$1
  fi

  mkdir -p "./opus"

  # Using ffmpeg
  fd -e "${input_format}" -d 1 -x ffmpeg -i "{}" -b:a 320k "./opus/{.}.opus"

  # Using opusenc
  # fd -e "${input_format}" -d 1 -x opusenc "{}" --bitrate 320 "./opus/{.}.opus"
}

# source some installed configurations
for file (
    /usr/share/fzf/key-bindings.zsh
    "$CARGO_HOME/env"
  )
do
  if [ -f "$file" ]; then
    source "$file"
  fi
done

eval "$(zoxide init zsh)"

eval "$(starship init zsh)"
